# 缓存优化

## 环境配置
- 配置yml文件中的redis
- maven导入redis

## 缓存短信验证码

## 缓存菜品数据

- 先从redis获取数据，如果有直接返回;没有的话从数据库中找，把数据放入到redis中。
- 更新菜品数据时(或者数据库中的数据变化时)，需要清理缓存数据。



## Spring Cache

- 可以简化缓存操作的代码

- @EnableCaching 开启缓存注解功能
- @Cacheable 在方法执行前，先检查缓存中是否有数据，如果有，直接返回，如果没有，调用方法并把方法返回值放到缓存中
- @CachePut 把方法的返回值放到缓存中
- @CacheEvict 把一条或者多条数据从缓存中删除

### 其它

在Spring缓存注解中，`key`是一个SpEL（Spring表达式语言）表达式，你可以使用`#root`和`#result`在SpEL表达式中获取上下文数据。

- `#root`：这是根对象，可以通过它访问到方法的各种元信息，如方法的名称（`#root.methodName`），方法的参数数组（`#root.args`）等。
- `#result`：这是方法的返回结果，只能在`@CachePut`和`@CacheEvict`（当`beforeInvocation`设为`false`）注解中使用。

```
@Cacheable(value = "books", key = "#root.methodName")
public Book findBookByIsbn(String isbn) {
    // Some code to fetch book from database
    return book;
}
```
在这个例子中，缓存的键将会是`findBookByIsbn`，也就是方法的名称。

```
@CachePut(value = "books", key = "#isbn", condition = "#result!=null")
public Book updateBook(String isbn, Book updatedBook) {
    // Some code to update book in the database
    return updatedBook;
}
```


### @Cacheable

`@CachePut`是Spring框架中的一个注解，它可以用来更新缓存数据。该注解用在方法上，能确保方法被执行后，其结果会被存储在缓存中。
如果缓存中已存在相应的数据，那么`@CachePut`会使用新的结果更新缓存。
 > key 代表的是传递进来的对象，返回值作为缓存的value值

```
    @CachePut(value = "books", key = "#book.id")
    public Book updateBook(Book book) {
        // update book in the database
        return updatedBook;
    }
```

在这个示例中，`@CachePut`注解被用在`updateBook`方法上。当这个方法被调用时，它首先会更新数据库中的一本书的信息，然后将更新后的`Book`对象作为返回值。
`@CachePut`注解确保了这个更新后的`Book`对象会被存储在名为"books"的缓存中。缓存中的键是`Book`对象的`id`属性,值则是返回值`updatedBook`。

使用`@CachePut`可以保证缓存中的数据始终与数据库中的数据保持一致。它在以下情况下非常有用：

- 当你更改了数据库中的一条数据，并且想要立即在缓存中反映这个更改时。
- 当你想在执行某个方法后，总是将结果存储在缓存中时。

### @CacheEvict





















































